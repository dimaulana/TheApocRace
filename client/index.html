<!-- Author: Dido Maulana -->


<!DOCTYPE html>
<head>
	<!-- JQuery, Bootstrap CDN -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>


	<!-- Internal script import -->
	<script src="client/script/menuBuilder.js"></script>
	<link rel="stylesheet" type="text/css" href="client/css/main.css" />
</head>
<body>
	<!-- Canvas Container -->
	<div class="gameC">
		 <canvas id="game" width="1280" height="720" style="border:1px solid #000000; display:none;"> </canvas>
	</div>

	<div class="star">
		<div class="container h-100">


			<div class="row h-100 justify-content-center align-items-center">
				<div class="content">
					<h1>The Apocalyptic Race</h1>
					<!-- Login Screen -->
					<div id="account">

						<form method="POST" id="account-info" class="form-signin justify-content-center" onsubmit="validate(); return false;">
							<input id="account-username" type="text" class="form-control" name="username" placeholder="Username" required="" autofocus="" />
							<input id="account-password" type="password" class="form-control" name="password" placeholder="Password" required=""/>
							<div class="btn-group">
								<button id="signIn" class="btn btn-primary ml-2" type="submit">Sign In</button>
								<button id="signUp" class="btn btn-primary ml-2" type="submit">Sign Up</button>
								<button id="forgotPass" class="btn btn-primary ml-2" type="submit">Forgot Password</button>
								<button id="resetPass" class="btn btn-primary ml-2" type="submit" style="display: none;">Reset Password</button>

							</div>
						</form>
					</div>

					<!-- Interface Container -->
					<div class="interface">

					</div>
					<!-- Menu Container -->
					<div class="menu btn-group-vertical">

					</div>


				</div>
			</div>
		</div>
	</div>


</body>
</html>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>

<script type="text/javascript">
	var socket = io();

	var buttonClicked;

	$("button").click(function() {
		buttonClicked = $(this).attr("id");
	});


	function validate() {
		var user = $('#account-username').val();
		var pw = $('#account-password').val();

		switch (buttonClicked) {
			case "signIn":
				socket.emit('signIn', {username: user, password: pw});
				console.log("emitted");
				break;

			case "signUp":
				socket.emit('signUp', {username: user, password: pw});
				console.log("sign up");
				break;

			case "forgotPass":
				showHideResetPassword(true);
				console.log("Reseting Password");
				break;

			case "resetPass":
				socket.emit('resetPassword', {username: user, password: pw});
				break;

		}
	}

	function showHideResetPassword(show) {

		var display;
		var resetDisplay;
		var placeholder;

		var passElement  = document.getElementById("account-password");
		if (show) {
			placeholder = "New Password";
			passElement.value = "";

			display = "none";
			resetDisplay = "inline";
		}

		else {
			placeholder = "Password";
			display = "inline";
			resetDisplay = "none";
		}

		passElement.placeholder = placeholder;

		document.getElementById("signIn").style.display = display;
		document.getElementById("signUp").style.display = display;
		document.getElementById("forgotPass").style.display = display;
		document.getElementById("resetPass").style.display = resetDisplay;
	}


	socket.on('signInResponse', function(data) {
		if (data.success) {
			console.log("Success");
			$('#account').hide();
			generateMenus("mainMenu");
		}
		else
			alert("Sign in failed.");
	});

	socket.on('signUpResponse', function(data) {
		if (data.success) {
			alert("Sign up successful.");
		}
		else
			alert("Sign up unsuccessful.");
	});

	socket.on('resetPassResponse', function(data) {
		if (data.success) {
			alert("Password reset successful");
			showHideResetPassword(false);
		}
		else
			alert("Password reset failed");
	});

//canvas
var ctx = document.getElementById("game").getContext("2d");
ctx.font = '30px Arial';

var HEIGHT = 720;
var WIDTH = 1280;
var timeWhenGameStarted = Date.now();	//return time in ms

var frameCount = 0;

var score = 0;

var Img = {};
Img.player = new Image();
Img.player.src = "/client/images/character.png";

testCollisionRectRect = function(rect1,rect2){
	return rect1.x <= rect2.x+rect2.width
		&& rect2.x <= rect1.x+rect1.width
		&& rect1.y <= rect2.y + rect2.height
		&& rect2.y <= rect1.y + rect1.height;
}

Player = function(){
	var self = {
		x:50,
		y: 600,
		hp: 0,
		width: 30,
		height: 5,
		img: 'client/images/player.png'
	}

	self.draw = function(){
		// ctx.save();
		var x = self.x-self.width/2;
		var y = self.y-self.height/2;
		// var image = getImage(self.img);
		ctx.drawImage(Img.player,x,y);
		//ctx.restore();
	}
	return self;
}

function getImage(imageName) {
  var x = document.createElement("IMG");
  x.setAttribute("src", imageName);
  x.setAttribute("width", "50");
  x.setAttribute("height", "50");

  return x;
}

startNewGame = function(player){
	$(".star").hide();
	$('#game').show();
	player.hp = 10;
	timeWhenGameStarted = Date.now();
	frameCount = 0;
	score = 0;
	player.draw();
}

Entity = function(type,id,x,y,spdX,spdY,width,height,img){
	var self = {
		type:type,
		id:id,
		x:x,
		y:y,
		spdX:spdX,
		spdY:spdY,
		width:width,
		height:height,
		img:img,
	};
	self.update = function(){
		self.updatePosition();
		self.draw();
	}
	self.draw = function(){
		ctx.save();
		var x = self.x-self.width/2;
		var y = self.y-self.height/2;
		ctx.drawImage(self.img,x,y);
		ctx.restore();
	}
	self.getDistance = function(entity2){	//return distance (number)
		var vx = self.x - entity2.x;
		var vy = self.y - entity2.y;
		return Math.sqrt(vx*vx+vy*vy);
	}

	self.testCollision = function(entity2){	//return if colliding (true/false)
		var rect1 = {
			x:self.x-self.width/2,
			y:self.y-self.height/2,
			width:self.width,
			height:self.height,
		}
		var rect2 = {
			x:entity2.x-entity2.width/2,
			y:entity2.y-entity2.height/2,
			width:entity2.width,
			height:entity2.height,
		}
		return testCollisionRectRect(rect1,rect2);

	}
	self.updatePosition = function(){
		self.x += self.spdX;
		self.y += self.spdY;

		if(self.x < 0 || self.x > WIDTH){
			self.spdX = -self.spdX;
		}
		if(self.y < 0 || self.y > HEIGHT){
			self.spdY = -self.spdY;
		}
	}

	return self;
}

Actor = function(type,id,x,y,spdX,spdY,width,height,img,hp,atkSpd){
	var self = Entity(type,id,x,y,spdX,spdY,width,height,img);

	self.hp = hp;
	self.atkSpd = atkSpd;
	self.attackCounter = 0;
	self.aimAngle = 0;

	return self;
}
</script>
